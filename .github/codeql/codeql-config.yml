# SoulMatting Platform - CodeQL Configuration
# Author: Kim Hsiao
# Version: 1.0.0
# Created: 2024-01-20
# Last Updated: 2024-01-20

name: 'SoulMatting CodeQL Config'

# Disable default queries and use custom query suites
disable-default-queries: false

# Query suites to run
queries:
  - name: security-extended
    uses: security-extended
  - name: security-and-quality
    uses: security-and-quality
  - name: code-scanning
    uses: code-scanning

# Paths to include in analysis
paths:
  - 'apps/'
  - 'packages/'
  - 'libs/'

# Paths to exclude from analysis
paths-ignore:
  - '**/node_modules/'
  - '**/dist/'
  - '**/build/'
  - '**/coverage/'
  - '**/*.test.ts'
  - '**/*.test.js'
  - '**/*.spec.ts'
  - '**/*.spec.js'
  - '**/__tests__/'
  - '**/__mocks__/'
  - '**/test/'
  - '**/tests/'
  - '**/*.d.ts'
  - '**/generated/'
  - '**/migrations/'
  - '**/seeds/'
  - 'tools/'
  - 'scripts/'
  - 'docs/'
  - '*.md'
  - '*.json'
  - '*.yml'
  - '*.yaml'
  - 'Dockerfile*'
  - 'docker-compose*'

# Query filters
query-filters:
  # Exclude specific queries that may produce false positives
  - exclude:
      id: js/unused-local-variable
      # Reason: Development code may have temporary unused variables
  - exclude:
      id: js/debugger-statement
      # Reason: Will be caught by linting rules
  - exclude:
      id: js/alert-call
      # Reason: Will be caught by linting rules

# Custom query packs
packs:
  - codeql/javascript-queries

# Analysis configuration
analysis:
  # Increase timeout for large codebases
  timeout: 120

  # Memory settings
  memory: 4096

  # Thread settings
  threads: 0 # Use all available threads

# Language-specific settings
languages:
  javascript:
    # Include TypeScript files
    extensions:
      - '.js'
      - '.jsx'
      - '.ts'
      - '.tsx'
      - '.vue'

    # Extraction settings
    extraction:
      # Include dependencies for better analysis
      include-dependencies: true

      # TypeScript configuration
      typescript:
        # Use project's tsconfig.json
        use-project-config: true

        # Additional compiler options
        compiler-options:
          strict: true
          noImplicitAny: true
          noImplicitReturns: true
          noUnusedLocals: false # Handled by ESLint
          noUnusedParameters: false # Handled by ESLint

# Security-specific configuration
security:
  # Enable all security queries
  enable-all: true

  # Custom security patterns
  patterns:
    # SQL injection patterns
    - pattern: "SELECT.*\\$\\{.*\\}"
      message: 'Potential SQL injection vulnerability'
      severity: 'error'

    # XSS patterns
    - pattern: "innerHTML.*\\$\\{.*\\}"
      message: 'Potential XSS vulnerability'
      severity: 'warning'

    # Hardcoded secrets patterns
    - pattern: "(password|secret|key|token)\\s*=\\s*['\"]?[^'\"\\s]{8,}['\"]?"
      message: 'Potential hardcoded secret'
      severity: 'error'

# Performance optimization
optimization:
  # Cache analysis results
  cache: true

  # Incremental analysis
  incremental: true

  # Parallel processing
  parallel: true

# Reporting configuration
reporting:
  # SARIF output format
  format: 'sarif-latest'

  # Include source snippets
  include-source: true

  # Severity levels to report
  severity-levels:
    - 'error'
    - 'warning'
    - 'note'

  # Custom metadata
  metadata:
    project: 'SoulMatting Platform'
    version: '1.0.0'
    author: 'Kim Hsiao'
    contact: 'kim@soulmatting.com'
